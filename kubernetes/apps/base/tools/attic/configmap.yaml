# Attic Server Configuration
#
# Based on official template from https://github.com/zhaofengli/attic
apiVersion: v1
kind: ConfigMap
metadata:
  name: attic-config
  namespace: tools
  labels:
    app.kubernetes.io/name: attic
data:
  server.toml: |
    # Socket address to listen on
    listen = "[::]:8080"

    # Allowed `Host` headers (empty = all allowed)
    allowed-hosts = []

    # The canonical API endpoint of this server
    api-endpoint = "http://${IP_ATTIC}/"

    # Database connection (URL provided via ATTIC_SERVER_DATABASE_URL env var)
    [database]
    # url configured via environment variable

    # File storage configuration
    [storage]
    type = "local"
    path = "/var/lib/attic/storage"

    # Data chunking
    [chunking]
    nar-size-threshold = 65536  # 64 KiB
    min-size = 16384            # 16 KiB
    avg-size = 65536            # 64 KiB
    max-size = 262144           # 256 KiB

    # Compression
    [compression]
    type = "zstd"

    # Garbage collection
    [garbage-collection]
    interval = "12 hours"
