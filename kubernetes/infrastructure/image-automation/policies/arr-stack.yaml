# Arr-stack Image Policies
#
# Hotio images use release-X.X.X.BUILD tags
# Using semver extraction for proper version comparison
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImageRepository
metadata:
  name: radarr
  namespace: flux-system
spec:
  image: ghcr.io/hotio/radarr
  interval: 12h
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImagePolicy
metadata:
  name: radarr
  namespace: flux-system
spec:
  imageRepositoryRef:
    name: radarr
  filterTags:
    # Extract semver from release-X.Y.Z.BUILD format
    pattern: '^release-(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)\.(?P<build>\d+)$'
    extract: '$major.$minor.$patch-$build'
  policy:
    semver:
      range: ">=4.0.0"
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImageRepository
metadata:
  name: sonarr
  namespace: flux-system
spec:
  image: ghcr.io/hotio/sonarr
  interval: 12h
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImagePolicy
metadata:
  name: sonarr
  namespace: flux-system
spec:
  imageRepositoryRef:
    name: sonarr
  filterTags:
    # Extract semver from release-X.Y.Z.BUILD format
    pattern: '^release-(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)\.(?P<build>\d+)$'
    extract: '$major.$minor.$patch-$build'
  policy:
    semver:
      range: ">=4.0.0"
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImageRepository
metadata:
  name: bazarr
  namespace: flux-system
spec:
  image: ghcr.io/hotio/bazarr
  interval: 12h
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImagePolicy
metadata:
  name: bazarr
  namespace: flux-system
spec:
  imageRepositoryRef:
    name: bazarr
  filterTags:
    # Extract semver from release-X.Y.Z format
    pattern: '^release-(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)$'
    extract: '$major.$minor.$patch'
  policy:
    semver:
      range: ">=1.0.0"
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImageRepository
metadata:
  name: prowlarr
  namespace: flux-system
spec:
  image: ghcr.io/hotio/prowlarr
  interval: 12h
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImagePolicy
metadata:
  name: prowlarr
  namespace: flux-system
spec:
  imageRepositoryRef:
    name: prowlarr
  filterTags:
    # Extract semver from release-X.Y.Z.BUILD format
    pattern: '^release-(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)\.(?P<build>\d+)$'
    extract: '$major.$minor.$patch-$build'
  policy:
    semver:
      range: ">=2.0.0"
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImageRepository
metadata:
  name: qbittorrent
  namespace: flux-system
spec:
  image: ghcr.io/hotio/qbittorrent
  interval: 12h
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImagePolicy
metadata:
  name: qbittorrent
  namespace: flux-system
spec:
  imageRepositoryRef:
    name: qbittorrent
  filterTags:
    # Extract semver from release-X.Y.Z format
    pattern: '^release-(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)$'
    extract: '$major.$minor.$patch'
  policy:
    semver:
      range: ">=5.0.0"
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImageRepository
metadata:
  name: sabnzbd
  namespace: flux-system
spec:
  image: ghcr.io/hotio/sabnzbd
  interval: 12h
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImagePolicy
metadata:
  name: sabnzbd
  namespace: flux-system
spec:
  imageRepositoryRef:
    name: sabnzbd
  filterTags:
    # Extract semver from release-X.Y.Z format
    pattern: '^release-(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)$'
    extract: '$major.$minor.$patch'
  policy:
    semver:
      range: ">=4.0.0"
