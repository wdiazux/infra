# Arr-stack Image Policies
#
# Hotio tagging varies by app:
# - bazarr, qbittorrent, sabnzbd: release-X.Y.Z format
# - radarr, sonarr, prowlarr: No version tags (commit-based only)
#
# NOTE: Radarr, Sonarr, and Prowlarr ImagePolicies are DISABLED because
# Hotio switched to commit-based tags (e.g., zeus-<hash>-<build>).
# Updates for these apps are managed by Renovate instead.

# Radarr - ImagePolicy DISABLED
# Reason: Hotio switched to commit-based tags (zeus-<hash>-<build>).
# Updates managed by Renovate instead.
# ---
# apiVersion: image.toolkit.fluxcd.io/v1
# kind: ImageRepository
# metadata:
#   name: radarr
#   namespace: flux-system
# spec:
#   image: ghcr.io/hotio/radarr
#   interval: 12h
# ---
# apiVersion: image.toolkit.fluxcd.io/v1
# kind: ImagePolicy
# metadata:
#   name: radarr
#   namespace: flux-system
# spec:
#   imageRepositoryRef:
#     name: radarr
#   filterTags:
#     pattern: '^zeus-(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)\.(?P<build>\d+)$'
#     extract: '$major.$minor.$patch-$build'
#   policy:
#     semver:
#       range: ">=6.0.0 <8.0.0"
# Sonarr - ImagePolicy DISABLED
# Reason: Hotio switched to commit-based tags (v4-<hash>) without version info.
# Updates managed by Renovate instead.
# ---
# apiVersion: image.toolkit.fluxcd.io/v1
# kind: ImageRepository
# metadata:
#   name: sonarr
#   namespace: flux-system
# spec:
#   image: ghcr.io/hotio/sonarr
#   interval: 12h
# ---
# apiVersion: image.toolkit.fluxcd.io/v1
# kind: ImagePolicy
# metadata:
#   name: sonarr
#   namespace: flux-system
# spec:
#   imageRepositoryRef:
#     name: sonarr
#   filterTags:
#     pattern: '^release-(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)\.(?P<build>\d+)$'
#     extract: '$major.$minor.$patch-$build'
#   policy:
#     semver:
#       range: ">=4.0.0 <6.0.0"
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImageRepository
metadata:
  name: bazarr
  namespace: flux-system
spec:
  image: ghcr.io/hotio/bazarr
  interval: 12h
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImagePolicy
metadata:
  name: bazarr
  namespace: flux-system
spec:
  imageRepositoryRef:
    name: bazarr
  filterTags:
    # Extract semver from release-X.Y.Z format
    pattern: '^release-(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)$'
    extract: '$major.$minor.$patch'
  policy:
    semver:
      range: ">=1.0.0 <3.0.0"
# Prowlarr - ImagePolicy DISABLED
# Reason: Hotio switched to commit-based tags (testing-<hash>-<build>).
# Updates managed by Renovate instead.
# ---
# apiVersion: image.toolkit.fluxcd.io/v1
# kind: ImageRepository
# metadata:
#   name: prowlarr
#   namespace: flux-system
# spec:
#   image: ghcr.io/hotio/prowlarr
#   interval: 12h
# ---
# apiVersion: image.toolkit.fluxcd.io/v1
# kind: ImagePolicy
# metadata:
#   name: prowlarr
#   namespace: flux-system
# spec:
#   imageRepositoryRef:
#     name: prowlarr
#   filterTags:
#     pattern: '^release-(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)\.(?P<build>\d+)$'
#     extract: '$major.$minor.$patch-$build'
#   policy:
#     semver:
#       range: ">=2.0.0 <4.0.0"
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImageRepository
metadata:
  name: qbittorrent
  namespace: flux-system
spec:
  image: ghcr.io/hotio/qbittorrent
  interval: 12h
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImagePolicy
metadata:
  name: qbittorrent
  namespace: flux-system
spec:
  imageRepositoryRef:
    name: qbittorrent
  filterTags:
    # Extract semver from release-X.Y.Z format
    pattern: '^release-(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)$'
    extract: '$major.$minor.$patch'
  policy:
    semver:
      range: ">=5.0.0 <7.0.0"
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImageRepository
metadata:
  name: sabnzbd
  namespace: flux-system
spec:
  image: ghcr.io/hotio/sabnzbd
  interval: 12h
---
apiVersion: image.toolkit.fluxcd.io/v1
kind: ImagePolicy
metadata:
  name: sabnzbd
  namespace: flux-system
spec:
  imageRepositoryRef:
    name: sabnzbd
  filterTags:
    # Extract semver from release-X.Y.Z format
    pattern: '^release-(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)$'
    extract: '$major.$minor.$patch'
  policy:
    semver:
      range: ">=4.0.0 <6.0.0"
