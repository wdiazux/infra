# Infrastructure Controllers
#
# Core cluster infrastructure components.
#
# BOOTSTRAP NOTE:
# Cilium and Longhorn are installed via Terraform during cluster bootstrap:
# - Cilium: terraform/talos/cilium-inline.tf (Talos inlineManifest)
# - Longhorn: terraform/talos/helm.tf (Helm provider)
#
# FluxCD can adopt/manage these installations for upgrades.
# Uncomment the resources below to transition management to FluxCD.
#
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  # Helm repositories (required for HelmReleases)
  - helm-repositories.yaml
  # CNI - Now managed by FluxCD for Ingress controller upgrade
  - cilium.yaml
  # Storage - Installed via Terraform, uncomment to manage with FluxCD:
  # - longhorn.yaml
  # GPU support
  - nvidia-gpu.yaml
  # Metrics API (enables kubectl top, k9s metrics)
  - metrics-server.yaml
  # CSI Snapshot Controller (required for volume snapshots)
  - snapshot-controller.yaml
  # Backup and Disaster Recovery (requires Longhorn for CSI snapshots)
  - velero.yaml
  # TLS certificate management (Let's Encrypt via Cloudflare DNS-01)
  - cert-manager.yaml
  # Secret/ConfigMap replication across namespaces (for TLS cert distribution)
  - reflector.yaml
  # PostgreSQL operator (CloudNative-PG)
  - cnpg-operator.yaml
  # Gateway API infrastructure (Cilium Gateway for HTTPS routing)
  - ../gateway
