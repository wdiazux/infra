# Ansible Configuration for Infrastructure Management
#
# This configuration file sets defaults for Ansible playbooks
# managing Talos Linux, traditional VMs, and Proxmox infrastructure.
#
# Minimum Requirements:
#   - ansible-core >= 2.17.0
#   - Python >= 3.9
#
# Updated: 2026-01-06

[defaults]
# Inventory
inventory = ./inventories/proxmox_hosts.yml

# Connection settings
host_key_checking = False
timeout = 30
gathering = smart
fact_caching = jsonfile
fact_caching_connection = /tmp/ansible_facts
fact_caching_timeout = 86400

# Compatibility: Required for community.sops with ansible-core 2.20+
# This prevents INJECT_FACTS_AS_VARS deprecation warning
inject_facts_as_vars = True

# Deprecation and error handling
deprecation_warnings = True
# Note: error_on_undefined_vars removed - deprecated in ansible-core 2.23+
any_errors_fatal = False
force_handlers = True

# Output
stdout_callback = default
result_format = yaml
bin_ansible_callbacks = True
display_skipped_hosts = False
display_ok_hosts = True

# Roles
roles_path = ./roles:~/.ansible/roles:/usr/share/ansible/roles

# Collections
collections_path = ./collections:~/.ansible/collections:/usr/share/ansible/collections

# Retry files
retry_files_enabled = False

# Interpreter discovery (recommended for mixed environments)
interpreter_python = auto_silent

# SSH settings (for Proxmox host and traditional VMs, not Talos)
[ssh_connection]
ssh_args = -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no
pipelining = True
control_path = /tmp/ansible-ssh-%%h-%%p-%%r

# Privilege escalation
[privilege_escalation]
become = True
become_method = sudo
become_user = root
become_ask_pass = False

# Galaxy
[galaxy]
server_list = release_galaxy

[galaxy_server.release_galaxy]
url = https://galaxy.ansible.com/

[inventory]
# Enable specific inventory plugins
enable_plugins = yaml, ini
