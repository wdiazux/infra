# Ansible Inventory for Talos Infrastructure
#
# Copy this file to hosts.yml and customize with your actual values
# cp hosts.yml.example hosts.yml
#
# NOTE: hosts.yml is in .gitignore to prevent committing sensitive info

---
all:
  vars:
    # Global variables
    ansible_python_interpreter: /usr/bin/python3

# Proxmox hosts (for Day 0 preparation)
proxmox:
  hosts:
    pve:
      ansible_host: 192.168.1.10  # Your Proxmox host IP
      ansible_user: root
      ansible_ssh_private_key_file: ~/.ssh/id_rsa

      # Proxmox-specific variables
      proxmox_api_url: "https://192.168.1.10:8006/api2/json"
      proxmox_node_name: "pve"

      # Hardware details
      cpu_vendor: "amd"  # or "intel"
      has_gpu: true
      gpu_pci_id: "01:00"

      # Storage
      zfs_pool: "local-zfs"
      zfs_arc_max_gb: 16

  vars:
    # Proxmox defaults
    ansible_port: 22

# Talos nodes (accessed via talosctl API, not SSH)
talos_nodes:
  hosts:
    talos-node:
      # Node information
      node_ip: 192.168.1.100  # Static IP assigned to Talos node
      node_name: "talos-node"
      vm_id: 100

      # Talos API endpoint (no SSH!)
      talos_endpoint: "https://192.168.1.100:50000"

      # Kubernetes API endpoint
      k8s_endpoint: "https://192.168.1.100:6443"

      # Hardware configuration
      cpu_cores: 8
      memory_mb: 32768
      disk_size_gb: 200
      has_gpu: true

      # Network configuration
      gateway: "192.168.1.1"
      netmask: 24
      dns_servers:
        - "8.8.8.8"
        - "8.8.4.4"

  vars:
    # Talos cluster variables
    cluster_name: "homelab-k8s"
    talos_version: "v1.11.4"
    kubernetes_version: "v1.31.0"

    # Talosconfig and kubeconfig paths (from Terraform)
    talosconfig_path: "../terraform/talosconfig"
    kubeconfig_path: "../terraform/kubeconfig"

    # CNI
    cni_provider: "cilium"
    cilium_version: "1.18.0"

    # Storage
    nfs_server: "192.168.1.200"
    nfs_path: "/mnt/tank/k8s-storage"

# Traditional VMs (if any) - accessed via SSH
traditional_vms:
  children:
    debian_vms:
      hosts:
        # debian-vm:
        #   ansible_host: 192.168.1.110
        #   ansible_user: admin

    ubuntu_vms:
      hosts:
        # ubuntu-vm:
        #   ansible_host: 192.168.1.111
        #   ansible_user: admin

    arch_vms:
      hosts:
        # arch-vm:
        #   ansible_host: 192.168.1.112
        #   ansible_user: admin

  vars:
    ansible_ssh_private_key_file: ~/.ssh/id_rsa

# NAS/Storage hosts
nas:
  hosts:
    nas-server:
      ansible_host: 192.168.1.200  # Your NAS IP
      ansible_user: admin  # Or appropriate user

      # NFS configuration
      nfs_exports:
        - path: "/mnt/tank/k8s-storage"
          clients: "192.168.1.0/24"
          options: "rw,sync,no_subtree_check,no_root_squash"

        - path: "/mnt/tank/backups"
          clients: "192.168.1.0/24"
          options: "rw,sync,no_subtree_check"

      # Samba configuration (if applicable)
      smb_shares:
        - name: "k8s-storage"
          path: "/mnt/tank/k8s-storage"
          guest_ok: false

# Control machine (where Ansible runs from)
localhost:
  hosts:
    control:
      ansible_connection: local
      ansible_python_interpreter: /usr/bin/python3

# Group variables by function
day0_hosts:
  children:
    proxmox: {}

day1_hosts:
  children:
    talos_nodes: {}

day2_hosts:
  children:
    talos_nodes: {}

# Notes:
# - Talos nodes don't use SSH - all operations via talosctl API
# - Proxmox host requires SSH access for Day 0 preparation (IOMMU, etc.)
# - Traditional VMs use standard SSH connection
# - NAS may use SSH or API depending on the system (TrueNAS, Synology, etc.)
# - Update IPs, usernames, and paths to match your infrastructure
# - Use ansible-vault or SOPS for sensitive variables (passwords, tokens)
# - talosconfig and kubeconfig are generated by Terraform
