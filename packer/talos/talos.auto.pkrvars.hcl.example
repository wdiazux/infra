# Talos Packer Variables Example
#
# Copy this file to talos.auto.pkrvars.hcl and fill in your actual values
# cp talos.auto.pkrvars.hcl.example talos.auto.pkrvars.hcl
#
# NOTE: talos.auto.pkrvars.hcl is in .gitignore to prevent committing credentials

# Proxmox Connection (required)
proxmox_url      = "https://your-proxmox-host.local:8006/api2/json"
proxmox_username = "terraform@pve"
proxmox_token    = "PVEAPIToken=terraform@pve!terraform-token=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
proxmox_node     = "pve"

# Or use username/password (less secure)
# proxmox_username = "root@pam"
# proxmox_password = "your-password"

# Skip TLS verification for self-signed certs (homelab)
proxmox_skip_tls_verify = true

# Talos Configuration (required)
talos_version = "v1.11.4"

# Generate your schematic at https://factory.talos.dev/
# Include extensions:
# - siderolabs/qemu-guest-agent
# - nonfree-kmod-nvidia-production
# - nvidia-container-toolkit-production
# Platform: "Metal"
talos_schematic_id = "your-schematic-id-here"  # Example: "abc123def456..."

# Or specify full ISO URL if you prefer
# talos_iso_url = "https://factory.talos.dev/image/abc123/v1.11.4/metal-amd64.iso"

# VM Template Configuration
template_name        = "talos-1.11.4-nvidia-template"
template_description = "Talos Linux v1.11.4 with NVIDIA GPU support and qemu-guest-agent"
vm_id                = 9000  # Must be unique in Proxmox

# VM Hardware Resources
vm_cpu_type = "host"  # MUST be 'host' for Talos v1.0+ and Cilium
vm_cores    = 4
vm_sockets  = 1
vm_memory   = 8192  # 8GB for build process

# Disk Configuration
vm_disk_size    = "150G"  # Adjust based on your needs (minimum 100G recommended)
vm_disk_storage = "tank"  # Your ZFS pool name
vm_disk_type    = "scsi"

# Network Configuration
vm_network_bridge = "vmbr0"
vm_network_model  = "virtio"
vm_network_vlan   = 0  # Set to VLAN ID if using VLANs, 0 for no VLAN

# Build Configuration
boot_wait   = "10s"
ssh_timeout = "30m"  # Packer will timeout (expected, Talos has no SSH)

# Notes:
# - Proxmox API token: Datacenter → Permissions → API Tokens → Create
# - Grant PVEVMAdmin and PVEDatastoreUser privileges to the token
# - Talos schematic: https://factory.talos.dev/ (select Metal platform + extensions)
# - CPU type 'host' is required for Talos v1.0+ (x86-64-v2) and Cilium compatibility
# - Disk size should accommodate OS + containers + local ephemeral storage
# - Persistent data goes to external NAS via NFS CSI driver (not on this disk)
